# Husky

[Husky](https://typicode.github.io/husky/) æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ Git Hooks å·¥å…·ï¼Œç”¨äºåœ¨ Git äº‹ä»¶è§¦å‘æ—¶æ‰§è¡Œè„šæœ¬ã€‚Laravel Skeleton é›†æˆäº† Husky æ¥ç¡®ä¿ä»£ç è´¨é‡å’Œæäº¤è§„èŒƒã€‚

## ä¸ºä»€ä¹ˆé€‰æ‹© Huskyï¼Ÿ

- ğŸ¯ è‡ªåŠ¨åŒ–ä»£ç æ£€æŸ¥ï¼šåœ¨æäº¤å‰è‡ªåŠ¨è¿è¡Œä»£ç æ£€æŸ¥
- ğŸ“ è§„èŒƒæäº¤ä¿¡æ¯ï¼šå¼ºåˆ¶æ‰§è¡Œç»Ÿä¸€çš„æäº¤ä¿¡æ¯æ ¼å¼
- ğŸ”„ ç®€å•æ˜“ç”¨ï¼šé›¶é…ç½®å®‰è£…ï¼Œå¼€ç®±å³ç”¨
- ğŸ› ï¸ é«˜åº¦å¯å®šåˆ¶ï¼šæ”¯æŒè‡ªå®šä¹‰ Git Hooks å’Œè„šæœ¬
- ğŸš€ æå‡å›¢é˜Ÿæ•ˆç‡ï¼šè‡ªåŠ¨åŒ–æµç¨‹ï¼Œå‡å°‘äººä¸ºé”™è¯¯
- ğŸ’ª ç¨³å®šå¯é ï¼šå¹¿æ³›ä½¿ç”¨çš„å·¥å…·ï¼Œç¤¾åŒºæ´»è·ƒ

## ç¯å¢ƒè¦æ±‚

- Node.js >= 16
- Git >= 2.13.0
- pnpm >= 8.0

## å¿«é€Ÿå¼€å§‹

Laravel Skeleton å·²ç»é¢„é…ç½®äº† Huskyï¼ŒåŒ…å«ä»¥ä¸‹**è‡ªåŠ¨åŒ–**åŠŸèƒ½ï¼š

1. æäº¤å‰ä»£ç æ£€æŸ¥ï¼š

   - ä½¿ç”¨ ESLint æ£€æŸ¥ JS æ–‡ä»¶ä¸­å¯èƒ½å­˜åœ¨çš„é”™è¯¯å¹¶è‡ªåŠ¨ä¿®å¤
   - ä½¿ç”¨ Prettier æ ¼å¼åŒ–æ‰€æœ‰é PHP æ–‡ä»¶
   - ä½¿ç”¨ Pint æ ¼å¼åŒ–æ‰€æœ‰ PHP æ–‡ä»¶
   - æ‰€æœ‰æ ¼å¼åŒ–æ“ä½œéƒ½æ˜¯è‡ªåŠ¨çš„ï¼Œæ— éœ€å†æ¬¡æ‰‹åŠ¨æ‰§è¡Œ `git add`

2. æäº¤ä¿¡æ¯æ ¼å¼éªŒè¯ï¼š

   - ä½¿ç”¨ Commitlint ç»Ÿä¸€å›¢é˜Ÿæˆå‘˜çš„ Git æäº¤ä¿¡æ¯æ ¼å¼
   - è‡ªåŠ¨æ£€æŸ¥æäº¤ä¿¡æ¯æ˜¯å¦ç¬¦åˆè§„èŒƒ
   - æä¾›æ¸…æ™°çš„é”™è¯¯æç¤º

3. æ¨é€å‰çš„æµ‹è¯•è¿è¡Œï¼š
   - ç¡®ä¿ä»£ç è´¨é‡
   - é˜²æ­¢é”™è¯¯ä»£ç è¿›å…¥ä»“åº“

## é…ç½®è¯¦è§£

### Git Hooks é…ç½®

Laravel Skeleton ä½¿ç”¨äº†ä»¥ä¸‹ Git Hooksï¼š

1. **pre-commit**ï¼š

   ```bash
   #!/bin/sh
   . "$(dirname "$0")/_/husky.sh"

   pnpm lint-staged
   ```

2. **commit-msg**ï¼š

   ```bash
   #!/bin/sh
   . "$(dirname "$0")/_/husky.sh"

   pnpm commitlint --edit $1
   ```

### Lint Staged é…ç½®

[Lint Staged](https://github.com/lint-staged/lint-staged) ç”¨äºåœ¨ Git æš‚å­˜åŒºæ–‡ä»¶ä¸Šè¿è¡Œ lintersï¼Œåœ¨ [`lint-staged.config.mjs`](https://github.com/zhaiyuxin103/laravel-skeleton/blob/main/lint-staged.config.mjs) ä¸­å®šä¹‰äº†æäº¤å‰çš„ä»£ç æ£€æŸ¥è§„åˆ™ã€‚

### Commitlint é…ç½®

[Commitlint](https://commitlint.js.org/) ç”¨äºæ£€æŸ¥æäº¤ä¿¡æ¯æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œåœ¨ [`commitlint.config.mjs`](https://github.com/zhaiyuxin103/laravel-skeleton/blob/main/commitlint.config.mjs) ä¸­å®šä¹‰äº†æäº¤ä¿¡æ¯æ ¼å¼è§„èŒƒã€‚

## ä½¿ç”¨æŒ‡å—

### æäº¤ä»£ç 

1. æš‚å­˜æ›´æ”¹ï¼š

   ```bash
   git add .
   ```

2. æäº¤ä»£ç ï¼š
   ```bash
   git commit -m "type(scope): commit message"
   ```

æäº¤ç±»å‹è¯´æ˜ï¼š

| ç±»å‹       | è¯´æ˜         | ä½¿ç”¨åœºæ™¯                                       |
| ---------- | ------------ | ---------------------------------------------- |
| `feat`     | æ–°åŠŸèƒ½       | æ·»åŠ æ–°åŠŸèƒ½ã€æ–°ç‰¹æ€§ã€æ–°æ¨¡å—                     |
| `fix`      | ä¿®å¤é—®é¢˜     | ä¿®å¤ bugã€è§£å†³é”™è¯¯ã€å¤„ç†å¼‚å¸¸                   |
| `docs`     | æ–‡æ¡£æ›´æ–°     | æ›´æ–°æ–‡æ¡£ã€æ³¨é‡Šã€READMEã€CHANGELOG              |
| `style`    | ä»£ç æ ¼å¼è°ƒæ•´ | ä»£ç æ ¼å¼åŒ–ã€è°ƒæ•´ä»£ç é£æ ¼ã€ä¸å½±å“ä»£ç é€»è¾‘çš„ä¿®æ”¹ |
| `refactor` | ä»£ç é‡æ„     | é‡æ„ä»£ç ã€ä¼˜åŒ–ä»£ç ç»“æ„ã€æå–å…¬å…±æ–¹æ³•           |
| `perf`     | æ€§èƒ½ä¼˜åŒ–     | æå‡æ€§èƒ½ã€ä¼˜åŒ–åŠ è½½é€Ÿåº¦ã€å‡å°‘èµ„æºæ¶ˆè€—           |
| `test`     | æµ‹è¯•ç›¸å…³     | æ·»åŠ æµ‹è¯•ã€ä¿®æ”¹æµ‹è¯•ç”¨ä¾‹ã€æ›´æ–°æµ‹è¯•é…ç½®           |
| `build`    | æ„å»ºç›¸å…³     | ä¿®æ”¹æ„å»ºå·¥å…·ã€æ›´æ–°ä¾èµ–é…ç½®ã€è°ƒæ•´æ„å»ºæµç¨‹       |
| `ci`       | æŒç»­é›†æˆ     | æ›´æ–° CI é…ç½®ã€ä¿®æ”¹éƒ¨ç½²æµç¨‹ã€è°ƒæ•´è‡ªåŠ¨åŒ–è„šæœ¬     |
| `chore`    | å…¶ä»–ä¿®æ”¹     | æ›´æ–°ä¾èµ–ã€æ¸…ç†ä¸´æ—¶æ–‡ä»¶ã€ä¿®æ”¹é…ç½®æ–‡ä»¶           |
| `revert`   | å›é€€æäº¤     | å›é€€ä»£ç ã€æ’¤é”€é”™è¯¯ä¿®æ”¹ã€æ¢å¤ä¹‹å‰çš„ç‰ˆæœ¬         |

::: tip æç¤º

- ç±»å‹å’Œè¯´æ˜ä¹‹é—´ä½¿ç”¨å†’å·åŠ ç©ºæ ¼åˆ†éš”
- è¯´æ˜éƒ¨åˆ†åº”è¯¥ç®€æ´æ˜äº†ï¼Œä¸è¶…è¿‡ 50 ä¸ªå­—ç¬¦
- å¦‚æœéœ€è¦åœ¨è¯´æ˜ä¸­æ·»åŠ æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨æ‹¬å·è¡¥å……
- scope æ˜¯å¯é€‰çš„ï¼Œç”¨äºè¯´æ˜ commit å½±å“çš„èŒƒå›´
- scope é€šå¸¸æ˜¯ä¸€ä¸ªåè¯ï¼Œä¾‹å¦‚ï¼šauthã€userã€apiã€db ç­‰
  :::

### è·³è¿‡æ£€æŸ¥

åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¯ä»¥è·³è¿‡ Husky æ£€æŸ¥ï¼š

```bash
git commit -m "message" --no-verify
# æˆ–ä½¿ç”¨ç®€å†™
git commit -m "message" -n
```

::: warning æ³¨æ„
ä¸å»ºè®®ç»å¸¸è·³è¿‡æ£€æŸ¥ï¼Œè¿™å¯èƒ½å¯¼è‡´ä»£ç è´¨é‡é—®é¢˜ã€‚
:::

## æœ€ä½³å®è·µ

### å¼€å‘å·¥ä½œæµ

1. ä¿æŒå°å‹æäº¤ï¼š

   - æ¯æ¬¡æäº¤ä¸“æ³¨äºå•ä¸€æ”¹åŠ¨
   - ä¾¿äºä»£ç å®¡æŸ¥å’Œå›æ»š

2. ç¼–å†™æ¸…æ™°çš„æäº¤ä¿¡æ¯ï¼š

   ```bash
   git commit -m "feat(auth): æ·»åŠ ç”¨æˆ·è®¤è¯åŠŸèƒ½"
   ```

3. å®šæœŸæ¨é€ä»£ç ï¼š
   - ç¡®ä¿æœ¬åœ°ä»£ç ä¸è¿œç¨‹åŒæ­¥
   - é¿å…å¤§é‡ç§¯å‹çš„æäº¤

### IDE é›†æˆ

#### PhpStorm ç”¨æˆ·

1. å®‰è£… [Git Commit Message Helper](https://plugins.jetbrains.com/plugin/13477-git-commit-message-helper) æ’ä»¶
   - æä¾›å¯è§†åŒ–çš„æäº¤ä¿¡æ¯ç¼–è¾‘ç•Œé¢
   - è‡ªåŠ¨ç”Ÿæˆç¬¦åˆè§„èŒƒçš„æäº¤ä¿¡æ¯
   - æ”¯æŒè‡ªå®šä¹‰æäº¤ç±»å‹å’Œæ¨¡æ¿
2. é…ç½® ESLint å’Œ Prettier æ’ä»¶
3. ä½¿ç”¨å†…ç½®çš„ Git åŠŸèƒ½

#### VSCode ç”¨æˆ·

1. å®‰è£… [Git Commit Plugin](https://marketplace.visualstudio.com/items?itemName=redjue.git-commit-plugin)
   - æ”¯æŒå¯è§†åŒ–æäº¤ä¿¡æ¯ç¼–è¾‘
   - è‡ªåŠ¨ç”Ÿæˆç¬¦åˆè§„èŒƒçš„æäº¤ä¿¡æ¯
   - æ”¯æŒè¡¨æƒ…ç¬¦å·å’Œè‡ªå®šä¹‰æ¨¡æ¿
   - å¤šè¯­è¨€æ”¯æŒï¼ˆåŒ…æ‹¬ä¸­æ–‡ï¼‰
2. é…ç½® ESLint å’Œ Prettier æ’ä»¶
3. ä½¿ç”¨å†…ç½®çš„ Git åŠŸèƒ½

## å¸¸è§é—®é¢˜

### 1. Husky é’©å­æœªæ‰§è¡Œ

- **é—®é¢˜æè¿°**ï¼šæäº¤æ—¶æ²¡æœ‰è§¦å‘æ£€æŸ¥
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  1. æ£€æŸ¥ `.husky` ç›®å½•æƒé™
  2. é‡æ–°å®‰è£… Huskyï¼š`pnpm husky install`
  3. ç¡®è®¤ Git Hooks è·¯å¾„ï¼š`git config core.hooksPath`

### 2. Lint æ£€æŸ¥å¤±è´¥

- **é—®é¢˜æè¿°**ï¼šä»£ç æ ¼å¼æ£€æŸ¥ä¸é€šè¿‡
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  1. è¿è¡Œ `pnpm lint` ä¿®å¤æ ¼å¼
  2. æ£€æŸ¥ ESLint å’Œ Prettier é…ç½®
  3. æ‰‹åŠ¨ä¿®å¤æŠ¥é”™çš„æ–‡ä»¶

### 3. Commitlint å¤±è´¥

- **é—®é¢˜æè¿°**ï¼šæäº¤ä¿¡æ¯æ ¼å¼ä¸ç¬¦åˆè¦æ±‚
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  1. æ£€æŸ¥æäº¤ç±»å‹æ˜¯å¦æ­£ç¡®
  2. ç¡®ä¿å†’å·åæœ‰ç©ºæ ¼
  3. ä½¿ç”¨æ­£ç¡®çš„æäº¤æ ¼å¼

## æ›´å¤šèµ„æº

- [Husky å®˜æ–¹æ–‡æ¡£](https://typicode.github.io/husky/)
- [Commitlint æ–‡æ¡£](https://commitlint.js.org/)
- [Lint Staged æ–‡æ¡£](https://github.com/okonet/lint-staged)
- [Laravel Skeleton é…ç½®](https://github.com/zhaiyuxin103/laravel-skeleton)
